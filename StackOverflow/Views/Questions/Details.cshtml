@{
  ViewBag.Title = "Questions";
}

@section SidebarLeft{
  @Html.Partial("Partials/_SidebarLeft")
}

@section SectionRight
{
  @Html.Partial("Partials/_SectionRight")
}

@section css
{
  @Styles.Render("~/bundles/css/Question")
}

@model StackOverflow.ViewModels.HomePageViewModel

<div class="col-12 col-md-9 col-lg-7 px-2">

  <div class="my-4">
    <!-- Question Section -->
    <article class="card border-bottom rounded-0">
      <div class="card-body">
        <div class="border-bottom mb-3">
          <div class="mb-3">
            <h1 class="h3 mb-2">@Model.Title</h1>
            <div class="text-muted small">
              <span>Đã hỏi <time>@Model.CreatedAt</time></span>
              <span class="mx-2">•</span>
              <span>Bởi <a href=@Url.Action("Index", "Users", new { id = Model.UserId })
                           class="link-primary">@Model.DisplayName</a></span>
              <span class="mx-2">•</span>
              <span>1 Lượt xem</span>
            </div>
          </div>
        </div>

        <div class="question-body mb-3">
          <p class="mb-3">@Model.Body</p>
          @*           <p class="mb-3">Tôi đang xây dựng một trang hỏi đáp với ASP.NET MVC, muốn có bố cục hiển thị câu hỏi chi *@
          @*             tiết, danh sách trả lời và form nhập câu trả lời. Có cách nào tối ưu cho việc phân trang và cache *@
          @*             không?</p> *@
          @* *@
          @*           <pre class="bg-light border p-3"><code>// QuestionController.cs *@
          @* public ActionResult Details(int id) { *@
          @*     var question = _db.Questions.Include(q => q.Answers) *@
          @*                                 .FirstOrDefault(q => q.Id == id); *@
          @*     return View(question); *@
          @* }</code></pre> *@
          @* *@
          @*           <p>Mọi người có thể gợi ý pattern nào tốt cho việc load câu trả lời không?</p> *@
          @*         </div> *@

          <div class="d-flex flex-wrap gap-2 mb-3">
            @foreach (var i in Model.Tags)
            {
              <a href=@Url.Action("Tag", "Questions", new { id = i }) class="badge tag-badge">@i</a>
            }
          </div>

        </div>
      </div>
    </article>

    <!-- Answer Form Section -->
    <section class="card mb-3">
      <div class="card-body">
        <h2 class="h4 mb-3">Thêm câu trả lời của bạn</h2>
        <form action="/Question/PostAnswer" method="post">
          <input type="hidden" name="QuestionId" value="123"/>
          <div class="mb-3">
            <label for="answerBody" class="form-label fw-semibold">Nội dung trả lời</label>
            <textarea
              class="form-control"
              id="answerBody"
              name="Body"
              rows="8"
              required
              aria-describedby="answerHelp"
              placeholder="Viết câu trả lời chi tiết, có ví dụ code nếu cần..."></textarea>
            <div id="answerHelp" class="form-text">
              Hỗ trợ Markdown cơ bản: **in đậm**, *in nghiêng*, `code inline`, và khối code với backtick 3 lần.
            </div>
          </div>

          <div class="d-flex gap-2">
            <button type="submit" class="px-3 btn-register" style="font-size: 14px;">
              <span class="pe-2 "><i class="bi bi-chat-left"></i></span>
              <span>Gửi</span>
            </button>
          </div>
        </form>
      </div>
    </section>
    <!-- Answers Section -->
    <section class="mb-4">
      <h2 class="h4 mb-3">@Model.AnswerCount câu trả lời khác</h2>

      <!-- Answer 1 - Accepted -->
      <article class="card mb-3 shadow-sm answer-accepted" style="border-left: 4px solid #48C774;: ">
        <div class="card-body">
          <!-- Answer Content -->
          <div class="answer-body mb-3">
            <p>Dùng Repository Pattern với Unit of Work để tách logic truy vấn. Triển khai lazy loading cho câu trả
              lời và cache với Output Cache hoặc Redis:</p>

            <pre class="bg-light border rounded p-3"><code>[OutputCache(Duration = 300, VaryByParam = "id")]
public ActionResult Details(int id) {
    var question = _questionRepo.GetById(id);
    return View(question);
}</code></pre>
            <p>Phân trang câu trả lời khi số lượng lớn (>20) để giảm tải trang ban đầu.</p>
          </div>

          <div class="answer-meta d-flex justify-content-between align-items-center">
            <div class="text-muted small">
              <span>trả lời bởi <a href="#" class="link-primary">devA</a></span>
              <span class="ms-2">1 giờ trước</span>
            </div>
          </div>
        </div>
      </article>
    </section>
  </div>
</div>