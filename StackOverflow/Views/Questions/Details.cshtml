@{
  ViewBag.Title = "Questions";
}

@section SidebarLeft{
  @Html.Partial("Partials/_SidebarLeft")
}

@section SectionRight
{
  @Html.Partial("Partials/_SectionRight")
}

@section css
{
  @Styles.Render("~/bundles/css/Question")
}

@using StackOverflow.Helpers
@model StackOverflow.ViewModels.DetailsQuestionViewModel

<div class="col-12 col-md-9 col-lg-7 px-2">

  <div class="my-4">
    <!-- Question Section -->
    <article class="card border-bottom rounded-0">
      <div class="card-body">
        <div class="border-bottom mb-3">
          <div class="mb-3">
            <h1 class="h3 mb-2">@Model.Question.Title</h1>
            <div class="text-muted small">
              <span>Đã hỏi <time>@StackOverflow.Helpers.DateTimeHelper.ConvertDateToString(Model.Question.CreatedAt)</time></span>
              <span class="mx-2">•</span>
              <span>Bởi <a href=@Url.Action("Index", "Users", new { id = Model.Question.UserId })
                           class="link-primary">@Model.Question.DisplayName</a></span>
              <span class="mx-2">•</span>
              <span>1 Lượt xem</span>
            </div>
          </div>
        </div>

        <div class="question-body mb-3">
          <p class="mb-3">@Model.Question.Body</p>
          @*           <p class="mb-3">Tôi đang xây dựng một trang hỏi đáp với ASP.NET MVC, muốn có bố cục hiển thị câu hỏi chi *@
          @*             tiết, danh sách trả lời và form nhập câu trả lời. Có cách nào tối ưu cho việc phân trang và cache *@
          @*             không?</p> *@
          @* *@
          @*           <pre class="bg-light border p-3"><code>// QuestionController.cs *@
          @* public ActionResult Details(int id) { *@
          @*     var question = _db.Questions.Include(q => q.Answers) *@
          @*                                 .FirstOrDefault(q => q.Id == id); *@
          @*     return View(question); *@
          @* }</code></pre> *@
          @* *@
          @*           <p>Mọi người có thể gợi ý pattern nào tốt cho việc load câu trả lời không?</p> *@
          @*         </div> *@

          <div class="d-flex flex-wrap gap-2 mb-3">
            @foreach (var i in Model.Question.Tags)
            {
              <a href=@Url.Action("Tag", "Questions", new { id = i }) class="badge tag-badge">@i</a>
            }
          </div>

        </div>
      </div>
    </article>

    <!-- Answer Form Section -->
    <section class="card mb-3">
      <div class="card-body">
        <h2 class="h4 mb-3">Thêm câu trả lời của bạn</h2>
        <form action="/Questions/PostAnswer" method="post">
          <input type="hidden" name="QuestionId" value=@Model.Question.QuestionId/>
          <input type="hidden" name="UserId" value=@Model.Question.UserId/>
          <div class="mb-3">
            <label for="answerBody" class="form-label fw-semibold">Nội dung trả lời</label>
            <textarea
              class="form-control"
              id="answerBody"
              name="body"
              rows="8"
              required
              aria-describedby="answerHelp"
              placeholder="Viết câu trả lời chi tiết, có ví dụ code nếu cần..."></textarea>
            <div id="answerHelp" class="form-text">
              Hỗ trợ Markdown cơ bản: **in đậm**, *in nghiêng*, `code inline`, và khối code với backtick 3 lần.
            </div>
          </div>

          <div class="d-flex gap-2">
            <button type="submit" class="px-3 btn-register" style="font-size: 14px;">
              <span class="pe-2 "><i class="bi bi-chat-left"></i></span>
              <span>Gửi</span>
            </button>
          </div>
        </form>
      </div>
    </section>
    <!-- Answers Section -->
    <section class="mb-4 p-3">
      <h2 class="h4 mb-3">@Model.Question.AnswerCount câu trả lời khác</h2>

      <!-- Answer - Accepted -->
      @foreach (var i in Model.Answers)
      {
        <article class="answer-item answer-accepted d-flex gap-3 p-3 mb-3">
          <div class="flex-grow-1">
            <div class="d-flex align-items-center justify-content-between mb-2">
              <div class="d-flex align-items-center gap-2" style="font-family: 'Roboto', sans-serif">

                <a href=@Url.Action("Index", "Users", new { id = i.UserId })
                   class="text-decoration-none fw-semibold d-flex align-items-center gap-2 text-dark">
                  <img src="https://i.pravatar.cc/64?img=22" class="rounded-circle" width="32" height="32" alt="">
                  <span>@i.DisplayName</span>
                </a>
                <i class="bi bi-check2-circle text-success" title="Accepted" style="font-size: 1rem"></i>

                <span class="text-muted small">@DateTimeHelper.ConvertDateToString(i.CreatedAt)</span>
              </div>
              <span class="badge text-bg-success">Accepted</span>
            </div>

            <div class="answer-body" style="font-size: 14px">
              <p>
                @i.Body
              </p>
            </div>
          </div>
        </article>
      }


    </section>
  </div>
</div>